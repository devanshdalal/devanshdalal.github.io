<!DOCTYPE HTML>
<!--
    Editorial by HTML5 UP
    html5up.net | @ajlkn
    Free for personal and commercial use under the CCA 3.0 license (html5up.net/license)
-->
<html>

<head>
  <title>Joshua Morton</title>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <!--[if lte IE 8]><script src="https://joshuamorton.github.io/assets/js/ie/html5shiv.js"></script><![endif]-->
  <link rel="stylesheet" href="../../../../assets/css/main.css" />
  <link rel="stylesheet" href="../../../../assets/css/custom.css" />
  <link rel="stylesheet" href="../../../../assets/css/highlight.css" />
  <!--[if lte IE 9]><link rel="stylesheet" href="https://joshuamorton.github.io/assets/css/ie9.css" /><![endif]-->
  <!--[if lte IE 8]><link rel="stylesheet" href="https://joshuamorton.github.io/assets/css/ie8.css" /><![endif]-->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/4.4.3/d3.min.js",
type="text/javascript"></script>
</head>


<body>
    <!-- Wrapper -->
    <div id="wrapper">
        <!-- Main -->
        <div id="main">
            <div class="inner">
                <!-- Header -->
  <header id="header">
    <a href="../../../../index.html" class="logo"><strong>Joshua Morton</strong> portfolio and blog</a>
    <ul class="icons">
      
      <li><a href="https://twitter.com/joshthejuggles" class="icon fa-twitter" target="_blank"><span class="label">Twitter</span></a></li>
      
      
      
      
      
      
      
      
      <li><a href="https://github.com/joshuamorton" class="icon fa-github" target="_blank"><span class="label">GitHub</span></a></li>
      
      
      
      <li><a href="https://www.linkedin.com/in/joshuamorton13" class="icon fa-linkedin" target="_blank"><span class="label">LinkedIn</span></a></li>
      
    </ul>
  </header>

                <!-- Content -->
                <section class="post-content">
                    <header class="main">
                        <h1>Writing a Type System</h1>
                    </header>

                  

                <div class='inner'>
    <section>
      <span class="post-date">04 Oct 2015</span>
      <p>Types are cool. Type systems are cool. That said, how they work is weird and
scary. Things like <code class="highlighter-rouge">object</code> and <code class="highlighter-rouge">type</code> and such are weird and a little
terrifying. “Metaclass” should send shivers down your spine. So lets have some
fun and pretend we’re writing python in python, and now we need to implement the
object system.</p>

<p>Let’s start with our “object” class, which in this case is very simple.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">obj</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>  <span class="c"># this is a class, not an instance of a class</span>
</code></pre>
</div>

<p>This seems strange and impossibly simple at first. However, in python, classes
are really just namespaces, since <code class="highlighter-rouge">Namespaces are one honking great idea --
let's do more of those!</code>. A namespace, in this case, really just being a
collection of names mapped to objects. A dictionary is incredibly good at this.
In fact, if your object does not take advantage of <code class="highlighter-rouge">__slots__</code>, a python object
is really just a dictionary with some additional attachments.</p>

<p>Next, we need to define our “api” for our classes. Python uses methods with
leading and trailing underscored (<code class="highlighter-rouge">__method_name__</code>), but for brevity’s sake,
I’ll use a single leading underscore. So, <code class="highlighter-rouge">_init</code> will the the initializer,
<code class="highlighter-rouge">_str</code> will be our toString/<code class="highlighter-rouge">__str__</code> function, and so on.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">default_str</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"&lt;instance of "</span> <span class="o">+</span> <span class="n">instance</span><span class="p">[</span><span class="s">"_name"</span><span class="p">]</span> <span class="o">+</span> <span class="s">"&gt;"</span>

<span class="k">def</span> <span class="nf">initialize</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="c"># the default initializer doesn't need to do anything</span>
    <span class="k">pass</span>

<span class="n">obj</span><span class="p">[</span><span class="s">"_init"</span><span class="p">]</span> <span class="o">=</span> <span class="n">initialize</span>
<span class="n">obj</span><span class="p">[</span><span class="s">"_str"</span><span class="p">]</span> <span class="o">=</span> <span class="n">default_str</span>
<span class="n">obj</span><span class="p">[</span><span class="s">"_cls"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"obj"</span>
</code></pre>
</div>

<p>Finally, a class needs to keep track of its parent for the purposes of
inheritance. Its possible to also support multiple inheritance, and I’ll tackle
that at the end. For now though, just single inheritance.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">obj</span><span class="p">[</span><span class="s">"_parent"</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span>
<span class="n">obj</span><span class="p">[</span><span class="s">"_name"</span><span class="p">]</span> <span class="o">=</span> <span class="s">"obj"</span>

</code></pre>
</div>

<p>This is a bit strange, but all classes should have a parent, so object is its
own parent. Strange family.</p>

<p>Now we can build out a few convenience methods for creating a class (this would
be the analog of <code class="highlighter-rouge">type</code> in python) and for instantiating a class (the analog of
the implicit parts of <code class="highlighter-rouge">__new__</code> that you can’t change in python). But first, we
need to do something special and a tad hacky.</p>

<p>Namely, because we are not using python’s built in object system, I can’t
override things like <code class="highlighter-rouge">__getattr__</code> to efficiently call methods stored on the
class. Instead, we have to bind them to the individual instances of an object to
be able to call methods with a familiar syntax (<code class="highlighter-rouge">obj.method(args)</code> instead of
<code class="highlighter-rouge">cls.method(obj, args)</code>). Maybe I’ll eventually address that.</p>

<p>So we need a function to bind a method to an instance of a class.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">bind_method</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">method</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">bound_method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">method</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bound_method</span>
</code></pre>
</div>
<p>Astute observers will notice that this resembles a simpler version of
<code class="highlighter-rouge">functools.partial</code>, and in fact you could use that instead. The downside of
using this method is that there will be an instance of <code class="highlighter-rouge">bound_method</code> attached
to every instance of a class, which is memory linear and less performant than
what python actually does.</p>

<p>Now we can instantiate an object.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span>
<span class="c"># we need this for special casing methods</span>

<span class="k">def</span> <span class="nf">new_instance</span><span class="p">(</span><span class="n">clazz</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="n">new_instance</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">clazz</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clazz</span><span class="p">[</span><span class="n">data</span><span class="p">],</span> <span class="n">FunctionType</span><span class="p">):</span>
            <span class="c"># special case for functions as they need to be bound</span>
            <span class="n">new_instance</span><span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="n">bind_method</span><span class="p">(</span><span class="n">new_instance</span><span class="p">,</span> <span class="n">clazz</span><span class="p">[</span><span class="n">data</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_instance</span><span class="p">[</span><span class="n">data</span><span class="p">]</span> <span class="o">=</span> <span class="n">clazz</span><span class="p">[</span><span class="n">data</span><span class="p">]</span>
    <span class="n">new_instance</span><span class="p">[</span><span class="s">"_init"</span><span class="p">](</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">new_instance</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">new_instance</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">x</span><span class="p">[</span><span class="s">"_str"</span><span class="p">]()</span> <span class="o">==</span> <span class="s">"&lt;instance of obj&gt;"</span>
</code></pre>
</div>

<p>Now we need some way to support inheritance. So lets define a method to declare
a type. Because defining every class manually is awful and unfun.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new_class</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="o">**</span><span class="n">methods</span><span class="p">):</span>
    <span class="n">new_cls</span> <span class="o">=</span> <span class="p">{</span><span class="n">val</span><span class="p">:</span> <span class="n">parent</span><span class="p">[</span><span class="n">val</span><span class="p">]</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">parent</span><span class="p">}</span>
    <span class="n">new_cls</span><span class="p">[</span><span class="s">"_parent"</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span>
    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="n">new_cls</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">new_cls</span>
</code></pre>
</div>

<p>This code defines a function that will define a class. This is analogous to
<code class="highlighter-rouge">type</code> as a metaclass. Note that this will overwrite functions and values on the
parent class, which is exactly the functionality we want. We also want to test
this to make sure everything is in good working order.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">init_person</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
    <span class="n">instance</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="o">=</span> <span class="n">name</span>
    <span class="n">instance</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span> <span class="o">=</span> <span class="n">age</span>

<span class="k">def</span> <span class="nf">person_string</span><span class="p">(</span><span class="n">instance</span><span class="p">):</span>
    <span class="k">return</span> <span class="s">"&lt;Hi my name is "</span> <span class="o">+</span> <span class="n">instance</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="o">+</span> <span class="s">"&gt;"</span>

<span class="k">def</span> <span class="nf">is_older</span><span class="p">(</span><span class="n">instance</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">instance</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">other</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span>

<span class="n">Person</span> <span class="o">=</span> <span class="n">new_class</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_init</span><span class="o">=</span><span class="n">init_person</span><span class="p">,</span> <span class="n">_str</span><span class="o">=</span><span class="n">person_string</span><span class="p">,</span>
                   <span class="n">is_older</span><span class="o">=</span><span class="n">is_older</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s">"Person"</span><span class="p">)</span>
<span class="n">john</span> <span class="o">=</span> <span class="n">new_instance</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="s">"john"</span><span class="p">,</span> <span class="mi">35</span><span class="p">)</span>
<span class="n">amy</span> <span class="o">=</span> <span class="n">new_instance</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> <span class="s">"amy"</span><span class="p">,</span> <span class="mi">26</span><span class="p">)</span>

<span class="k">assert</span> <span class="n">john</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">35</span>
<span class="k">assert</span> <span class="n">john</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="o">==</span> <span class="s">"john"</span>
<span class="k">assert</span> <span class="n">john</span><span class="p">[</span><span class="s">"is_older"</span><span class="p">](</span><span class="n">amy</span><span class="p">)</span>
</code></pre>
</div>

<p>This looks a bit different than the way that classes are normally instantiated,
but let’s take a look at <code class="highlighter-rouge">type</code>. It is defined as <code class="highlighter-rouge">class type(name, bases,
dict)</code>. Which means that on occasion, people will define classes using this
function.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">MyClass</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="s">"MyClass"</span><span class="p">,</span> <span class="p">(</span><span class="nb">object</span><span class="p">,</span> <span class="p">),</span> 
               <span class="p">{</span><span class="s">"__init__"</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">,</span> <span class="n">n</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">_name</span><span class="o">=</span><span class="n">n</span><span class="p">)})</span>
</code></pre>
</div>

<p>These look somewhat similar, a name, a base class, and a set of functions are
passed in and apparently a class comes out. In fact, when you define a class
normally in python, this is actually what is being done in the background
(because <code class="highlighter-rouge">type</code> is the default metaclass).</p>

<p>We still need to know whether or not the “inheritance” portion works. That’s
kinda important.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">Child</span> <span class="o">=</span> <span class="n">new_class</span><span class="p">(</span><span class="n">Person</span><span class="p">,</span> 
                  <span class="n">is_teen</span><span class="o">=</span><span class="k">lambda</span> <span class="n">inst</span><span class="p">:</span> <span class="mi">20</span> <span class="o">&gt;</span> <span class="n">inst</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">12</span><span class="p">,</span>
                  <span class="n">_name</span><span class="o">=</span><span class="s">"Child"</span><span class="p">)</span>

<span class="n">billy</span> <span class="o">=</span> <span class="n">new_instance</span><span class="p">(</span><span class="n">Child</span><span class="p">,</span> <span class="s">"billy"</span><span class="p">,</span> <span class="mi">7</span><span class="p">)</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">billy</span><span class="p">[</span><span class="s">"is_teen"</span><span class="p">]()</span>
<span class="k">assert</span> <span class="n">billy</span><span class="p">[</span><span class="s">"age"</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span>
</code></pre>
</div>

<p>It works!</p>

<p>So that’s single inheritance object oriented types in 20 lines of code. Pretty
cool. But python supports multiple inheritance, and even java does now. Mixins
are awesome. How do we support that? The change is surprisingly small, that said
I’m going to do it differently than python and model it after the way java 8
supports mixins.</p>

<p>The change we need to make to our previous function is actually rather simple:
instead of a single parent, we can have multiple parents. And unlike in python,
the parents are unordered. This way, there’s no need to define a method
resolution order. Additionally, we steal from java the rule that any time there
is a method conflict, ie. multiple parents implement a single method, the child
class must reimplment that method.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new_class_multi</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="o">**</span><span class="n">methods</span><span class="p">):</span>
    <span class="n">new_cls</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">conflicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">parent</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">new_cls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span>
                                        <span class="n">parent</span><span class="p">[</span><span class="n">member</span><span class="p">],</span> <span class="n">FunctionType</span><span class="p">):</span>
                <span class="n">conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
            <span class="n">new_cls</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="n">member</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">conflict</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conflict</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">"Method conflict on "</span> <span class="o">+</span> <span class="n">conflict</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="n">new_cls</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>

    <span class="n">new_cls</span><span class="p">[</span><span class="s">"_parent_class"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">parent</span><span class="p">[</span><span class="s">"_name"</span><span class="p">]:</span> <span class="n">parent</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">new_clsdef</span> <span class="n">new_class_multi</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="o">**</span><span class="n">methods</span><span class="p">):</span>
</code></pre>
</div>

<p>This does exactly what we want. It supports multiple inheritence, we avoid
method conflicts. All great things. Just one tiny issue: I now need to redefine
<code class="highlighter-rouge">_str</code> on ever class I define that inherits from multiple base classes. That is
annoying and antithetical to the goals of object oriented programming. It’s an
easy fix though.</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="k">def</span> <span class="nf">new_class_multi_fixed</span><span class="p">(</span><span class="n">parents</span><span class="p">,</span> <span class="o">**</span><span class="n">methods</span><span class="p">):</span>
    <span class="n">new_cls</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">conflicts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">member</span> <span class="ow">in</span> <span class="n">parent</span><span class="p">:</span>
            <span class="c"># something is a conflict if:</span>
            <span class="c">#   its name is being assigned over an existing value, because then</span>
            <span class="c">#       it is a conflicting name</span>
            <span class="c">#   the item is a function (ignore things like _name and _parents)</span>
            <span class="c">#   the functions are not identical (memorywise) because then, in</span>
            <span class="c">#       reality there is no conflict, its just that multiple classes</span>
            <span class="c">#       are implementing the same function</span>
            <span class="k">if</span> <span class="nb">all</span><span class="p">([</span><span class="n">new_cls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">member</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">,</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">parent</span><span class="p">[</span><span class="n">member</span><span class="p">],</span> <span class="n">FunctionType</span><span class="p">),</span>
                    <span class="ow">not</span> <span class="n">new_cls</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">member</span><span class="p">)</span> <span class="ow">is</span> <span class="n">parent</span><span class="p">[</span><span class="n">member</span><span class="p">]]):</span>
                <span class="n">conflicts</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">member</span><span class="p">)</span>
            <span class="n">new_cls</span><span class="p">[</span><span class="n">member</span><span class="p">]</span> <span class="o">=</span> <span class="n">parent</span><span class="p">[</span><span class="n">member</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">conflict</span> <span class="ow">in</span> <span class="n">conflicts</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">conflict</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
            <span class="k">raise</span> <span class="nb">RuntimeError</span><span class="p">(</span><span class="s">"Method conflict on "</span> <span class="o">+</span> <span class="n">conflict</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">methods</span><span class="p">:</span>
        <span class="n">new_cls</span><span class="p">[</span><span class="n">method</span><span class="p">]</span> <span class="o">=</span> <span class="n">methods</span><span class="p">[</span><span class="n">method</span><span class="p">]</span>

    <span class="n">new_cls</span><span class="p">[</span><span class="s">"_parent_class"</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">parent</span><span class="p">[</span><span class="s">"_name"</span><span class="p">]:</span> <span class="n">parent</span> <span class="k">for</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">parents</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">new_cls</span>
</code></pre>
</div>

<p>And there’s Java’s type system. Easy. Python’s is a bit more complex because of
the builtin resolution of method order. Now just to be sure, here are some tests
of the two new class multi methods</p>

<div class="language-python highlighter-rouge"><pre class="highlight"><code><span class="n">HTMLMixin</span> <span class="o">=</span> <span class="n">new_class</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">render_as_html</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">"&lt;p&gt;"</span><span class="o">+</span><span class="n">s</span><span class="p">[</span><span class="s">"_str"</span><span class="p">]()</span><span class="o">+</span><span class="s">"&lt;/p&gt;"</span><span class="p">,</span>
                      <span class="n">_name</span><span class="o">=</span><span class="s">"HTMLMixin"</span><span class="p">)</span>
<span class="n">CallableMixin</span> <span class="o">=</span> <span class="n">new_class</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_call</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">s</span><span class="p">,</span> <span class="n">_name</span><span class="o">=</span><span class="s">"Callable"</span><span class="p">)</span>
<span class="n">StrMixin</span> <span class="o">=</span> <span class="n">new_class</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">_str</span><span class="o">=</span><span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="s">"A different str function"</span><span class="p">,</span>
                     <span class="n">_name</span><span class="o">=</span><span class="s">"Printable"</span><span class="p">)</span>

<span class="n">testval</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">FailClass</span> <span class="o">=</span> <span class="n">new_class_multi</span><span class="p">([</span><span class="n">HTMLMixin</span><span class="p">,</span> <span class="n">CallableMixin</span><span class="p">],</span> <span class="n">_name</span><span class="o">=</span><span class="s">"Fails"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">testval</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">assert</span> <span class="n">testval</span>

<span class="n">testval</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">FailClass2</span> <span class="o">=</span> <span class="n">new_class_multi_fixed</span><span class="p">([</span><span class="n">HTMLMixin</span><span class="p">,</span> 
                                        <span class="n">CallableMixin</span><span class="p">],</span> <span class="n">_name</span><span class="o">=</span><span class="s">"Fails"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">testval</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">assert</span> <span class="ow">not</span> <span class="n">testval</span>

<span class="n">testval</span> <span class="o">=</span> <span class="bp">False</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">FailClass3</span> <span class="o">=</span> <span class="n">new_class_multi_fixed</span><span class="p">([</span><span class="n">HTMLMixin</span><span class="p">,</span> <span class="n">CallableMixin</span><span class="p">,</span> 
                                        <span class="n">StrMixin</span><span class="p">],</span> <span class="n">_name</span><span class="o">=</span><span class="s">"Fails"</span><span class="p">)</span>
<span class="k">except</span><span class="p">:</span>
    <span class="n">testval</span> <span class="o">=</span> <span class="bp">True</span>
<span class="k">assert</span> <span class="n">testval</span>
</code></pre>
</div>

<p>That’s a wrap. No syntactic sugar, but a working multiple inheritance type
system. Like always, <a href="https://github.com/joshuamorton/joshuamorton.github.com/blob/master/_blogscripts/2015-10-4-python.py">Here’s</a> the link
to the runnable python version of this post, and <a href="https://github.com/joshuamorton/joshuamorton.github.com/blob/master/_posts/2015-10-4-types.md">here’s</a> the link to the post source.</p>

    </section>
</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
        <h3>
          <a href="../../../../2017/01/25/juggling/index.html">
            What is an Average Juggle?
            <small>25 Jan 2017</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="../../../11/06/lambda-calculus/index.html">
            Lambda Calculus
            <small>06 Nov 2015</small>
          </a>
        </h3>
      </li>
    
      <li>
        <h3>
          <a href="../../../09/27/decorators/index.html">
            Decorators
            <small>27 Sep 2015</small>
          </a>
        </h3>
      </li>
    
  </ul>
</div>

                </section>
              </div>
          </div>

          <!-- Sidebar -->
  <div id="sidebar">
    <div class="inner">


      <!-- Menu -->
        <nav id="menu">
          <ul>
            <li><a href="../../../../index.html">Homepage</a></li>
            <li><a href="../../../../contact.html">Contact Me</a></li>
            <li><a href="../../../../experience.1.html">Experience</a></li>
            <li><a href="../../../../involvement.1.html">Involvement</a></li>
            <li><a href="../../../../projects.1.html">Projects</a></li>
          </ul>
        </nav>


      <!-- Section -->
        <section>
          <header class="major">
              <a href="../../../../blog.1.html"><h2>Blog</h2></a>
          </header>
          <nav id='menu'>
              <ul>
                
                <li><a href="../../../../2017/01/25/juggling/index.html">What is an Average Juggle?</a></li>
                
                <li><a href="../../../11/06/lambda-calculus/index.html">Lambda Calculus</a></li>
                
                <li><a href="index.html">Writing a Type System</a></li>
                
                <li><a href="../../../09/27/decorators/index.html">Decorators</a></li>
                
                <li><a href="../../../09/20/welcome-to-parseltongue/index.html">Welcome</a></li>
                   
              </ul>
          </nav>
        </section>

      <!-- Footer -->
        <footer id="footer">
          <p class="copyright">&copy; Joshua Morton. All rights reserved. Design: <a href="https://html5up.net">HTML5 UP</a>. Jekyll integration: <a href="https://andrewbanchi.ch">Andrew Banchich</a>.</p>
        </footer>

    </div>
  </div>


      </div>

      <!-- Scripts -->
  <script src="../../../../assets/js/jquery.min.js"></script>
  <script src="../../../../assets/js/skel.min.js"></script>
  <script src="../../../../assets/js/util.js"></script>
  <!--[if lte IE 8]><script src="https://joshuamorton.github.io/assets/js/ie/respond.min.js"></script><![endif]-->
  <script src="../../../../assets/js/main.js"></script>


</body>

</html>
